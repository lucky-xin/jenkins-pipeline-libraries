---
- name: Remove "{{ container_name }}" if exist
  docker_container:
    name: "{{ container_name }}"
    state: absent

- name: Run "{{ container_name }}"
  docker_container:
    image: "{{ container_image }}"
    env:
      APPLICATION_NAME: "{{ container_name }}"
      SERVER_PORT: "{{ container_port }}"
      JASYPT_PASSWORD: "{{ jasypt_password }}"
      SPRING_PROFILES_ACTIVE: "{{ deploy_environment }}"
    pull: yes
    name: "{{ container_name }}"
    networks:
      - name: pistonint-cloud-ucar
    ports:
      - "{{ container_port }}:{{ container_port }}"
    state: started
  when: not docker_debug_logs|bool

- name: Run "{{ container_name }}" debug
  docker_container:
    image: "{{ container_image }}"
    log_driver: syslog
    log_options:
      syslog-address: tcp://192.168.1.182:514
      syslog-facility: daemon
      tag: "{{ container_name }}"
    env:
      APPLICATION_NAME: "{{ container_name }}"
      SERVER_PORT: "{{ container_port }}"
      JASYPT_PASSWORD: "{{ jasypt_password }}"
      SPRING_PROFILES_ACTIVE: "{{ deploy_environment }}"
    pull: yes
    name: "{{ container_name }}"
    networks:
      - name: pistonint-cloud-ucar
    ports:
      - "{{ container_port }}:{{ container_port }}"
    state: started
  when: docker_debug_logs|bool
